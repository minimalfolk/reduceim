<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Resizer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .upload-box {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px dashed #ccc;
            text-align: center;
        }

        .upload-box input[type="file"] {
            display: none;
        }

        .upload-box label {
            cursor: pointer;
            font-size: 18px;
        }

        #imageContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .image-preview {
            text-align: center;
            width: 200px;
        }

        .image-preview img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-bottom: 10px;
        }

        #processing {
            display: none;
            font-size: 18px;
            color: red;
        }

        #downloadButton {
            display: none;
        }
    </style>
</head>
<body>

<!-- Header -->
<header>
    <h1>Image Resizer</h1>
</header>

<!-- Upload Box Section -->
<div class="upload-box" id="uploadBox">
    <label for="fileInput">Click to Upload Images:</label>
    <input type="file" id="fileInput" multiple accept="image/*">
</div>

<!-- Custom Size Input Section -->
<div class="size-input-container">
    <label for="sizeInput">Enter desired size (in KB):</label>
    <input type="number" id="sizeInput" placeholder="e.g., 100">
</div>

<!-- Resize Button -->
<button id="resizeButton">Resize All Images</button>

<!-- Processing Indicator -->
<div id="processing">Processing...</div>

<!-- Image Preview Section -->
<div id="imageContainer">
    <!-- Images will be previewed here -->
</div>

<!-- Download Button -->
<div id="downloadButton">
    <button id="downloadBtn">Download Compressed Images</button>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const uploadBox = document.getElementById('uploadBox');
    const processing = document.getElementById('processing');
    const imageContainer = document.getElementById('imageContainer');
    const resizeButton = document.getElementById('resizeButton');
    const downloadButton = document.getElementById('downloadButton');
    let images = [];

    // Handle file upload
    fileInput.addEventListener('change', (e) => {
        images = [];
        imageContainer.innerHTML = ''; // Clear previous previews

        const files = e.target.files;
        Array.from(files).forEach(file => {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const imgElement = document.createElement('img');
                    imgElement.src = event.target.result;
                    const imagePreview = document.createElement('div');
                    imagePreview.classList.add('image-preview');
                    const imageInfo = document.createElement('div');
                    imageInfo.textContent = `${file.name} - ${(file.size / 1024).toFixed(2)} KB`;

                    imagePreview.appendChild(imgElement);
                    imagePreview.appendChild(imageInfo);
                    imageContainer.appendChild(imagePreview);

                    images.push({ file, imgElement, imagePreview });
                };
                reader.readAsDataURL(file);
            }
        });
    });

    // Handle resizing
    resizeButton.addEventListener('click', () => {
        const targetSizeKB = parseInt(document.getElementById('sizeInput').value, 10);
        if (isNaN(targetSizeKB) || targetSizeKB <= 0) {
            alert("Please enter a valid target size in KB.");
            return;
        }

        processing.style.display = 'block';
        images.forEach(imageData => {
            const { file, imgElement, imagePreview } = imageData;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.src = imgElement.src;

            img.onload = () => {
                const width = img.width;
                const height = img.height;

                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);

                canvas.toBlob(blob => {
                    const compressedSizeKB = (blob.size / 1024).toFixed(2);
                    const newImage = document.createElement('img');
                    const newFileUrl = URL.createObjectURL(blob);

                    newImage.src = newFileUrl;
                    imagePreview.innerHTML = ''; // Clear old image and info
                    imagePreview.appendChild(newImage);
                    imagePreview.innerHTML += ` ${file.name} - Resized Size: ${compressedSizeKB} KB`;

                    const downloadLink = document.createElement('a');
                    downloadLink.href = newFileUrl;
                    downloadLink.download = file.name;
                    downloadLink.textContent = 'Download';
                    imagePreview.appendChild(downloadLink);
                }, 'image/jpeg', 0.8); // Resize quality (80%)
            };
        });

        processing.style.display = 'none';
    });
</script>

</body>
</html>
